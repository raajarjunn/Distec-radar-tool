{# accounts/edit.html â€” HTMX modal body (no extends, no nested card/header) #}
<div id="editRoleInner" class="px-4 py-3">

  <form method="post"
        hx-post="{% url 'role_admin_edit' object.pk %}"
        hx-target="#editRoleBody"
        hx-swap="innerHTML">
    {% csrf_token %}

    <div class="form-group mb-3">
      <label class="font-weight-semibold mb-1">User</label>
      <input class="form-control" value="{{ object.username }} ({{ object.email }})" disabled>
    </div>

    {# Render your form fields #}
    {{ form.as_p }}

    <div class="d-flex align-items-center mt-3">
      <button class="btn btn-primary mr-2" type="submit">Save</button>
      <!-- Works for both Bootstrap 4 and 5 -->
      <button class="btn btn-outline-secondary"
              type="button"
              data-dismiss="modal"
              data-bs-dismiss="modal">
        Cancel
      </button>
    </div>
  </form>

  <div class="text-muted small mt-3">Changes apply immediately after saving.</div>

  <style>
    /* Make {{ form.as_p }} look like BS form groups */
    #editRoleInner p { margin-bottom: 1rem; }
    #editRoleInner p > label { display:block; font-weight:600; margin-bottom:.25rem; }
    #editRoleInner p > input,
    #editRoleInner p > select,
    #editRoleInner p > textarea { width:100%; }

    /* Modal body should be white without extra inner borders */
    #editRoleInner { background:#fff; border-radius:12px; }

    /* Optional: subtle divider under the (parent) modal header */
    .modal-header { border-bottom: 1px solid #eef1f4; }
  </style>

  <script>
    (function () {
      // Ensure Cancel (and any [data-dismiss]/[data-bs-dismiss]) always closes the modal
      document.querySelectorAll('[data-dismiss="modal"], [data-bs-dismiss="modal"]').forEach(function (btn) {
        btn.addEventListener('click', function () {
          if (window.jQuery && typeof jQuery.fn.modal === 'function') {
            jQuery('#editRoleModal').modal('hide'); // Bootstrap 4
          } else if (window.bootstrap && bootstrap.Modal) {
            var el = document.getElementById('editRoleModal');
            bootstrap.Modal.getOrCreateInstance(el).hide(); // Bootstrap 5
          }
        });
      });

      // Make selects/inputs consistent if the form doesn't add classes itself
      document.querySelectorAll('#editRoleInner select:not(.form-control)').forEach(function (el) {
        el.classList.add('form-control');
      });
      document.querySelectorAll('#editRoleInner input[type="text"]:not(.form-control),\
                                #editRoleInner input[type="email"]:not(.form-control),\
                                #editRoleInner textarea:not(.form-control)').forEach(function (el) {
        el.classList.add('form-control');
      });

      // Friendly labels for role choices without changing submitted values
      var LABELS = { 1:'Super Admin', 2:'Admin', 3:'Read Only User', 4:'Basic User' };
      var sel = document.querySelector('#editRoleInner select[name$="role"], #editRoleInner select[name$="role_id"]');
      if (sel) {
        Array.prototype.forEach.call(sel.options, function (opt) {
          var v = (opt.value || opt.text || '').toString().trim();
          var n = parseInt(v, 10);
          if (!isNaN(n) && LABELS[n]) opt.text = LABELS[n];
          else {
            var key = v.toLowerCase().replace(/\s+/g, ' ');
            if (key === 'superadmin' || key === 'super admin') opt.text = LABELS[1];
            else if (key === 'admin') opt.text = LABELS[2];
            else if (key === 'read only user' || key === 'read only' || key === 'readonly') opt.text = LABELS[3];
            else if (key === 'basic user' || key === 'basic') opt.text = LABELS[4];
          }
        });
        // Tooltip with the selected role
        var setTitle = function(){ var o = sel.options[sel.selectedIndex]; sel.title = o ? o.text : ''; };
        sel.addEventListener('change', setTitle); setTitle();
      }

      // Hide "is_super_admin" checkbox if present (purely UI)
      document.querySelectorAll('#editRoleInner input[type=checkbox][name$="is_super_admin"]').forEach(function (cb) {
        var row = cb.closest('p, .form-group, .mb-3, div') || cb;
        row.style.display = 'none';
      });
    })();
  </script>
</div>
