{# accounts/edit.html â€” modal body partial (no extends) #}
<div class="p-3 p-md-4 bg-white">
  <div class="card" style="background:#fff;border:1px solid #ddd;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.08);overflow:hidden;">
    <div class="card-header" style="background:#fff;border-bottom:1px solid #eee;padding:16px 18px;">
      <h6 class="mb-0 fw-bold text-dark">Edit User Role</h6>
    </div>

    <div class="card-body" style="background:#fff;padding:18px;">
      <form method="post"
            hx-post="{% url 'role_admin_edit' object.pk %}"
            hx-target="#editRoleBody"
            hx-swap="innerHTML">
        {% csrf_token %}

        <div class="mb-3">
          <label class="form-label fw-semibold">User</label>
          <input class="form-control" value="{{ object.username }} ({{ object.email }})" disabled>
        </div>

        {{ form.as_p }}

        <div class="d-flex gap-2 mt-3">
          <button class="btn btn-primary" type="submit">Save</button>
          <button class="btn btn-outline-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <div class="text-muted small mt-3">Changes apply immediately after saving.</div>

  <script>
    (function(){
      // Map existing option values/texts to friendly labels without changing the POST value.
      const LABELS = { 1:'Super Admin', 2:'Admin', 3:'Read Only User', 4:'Basic User' };

      // Find the role <select> (works whether it's named "role" or "role_id").
      const sel = document.querySelector('#editRoleBody select[name$="role"], #editRoleBody select[name$="role_id"], .card select[name$="role"], .card select[name$="role_id"]');
      if (sel) {
        // Relabel options based on their value (preferred) or fallback to current text if value is missing.
        Array.from(sel.options).forEach(opt => {
          const asInt = parseInt(opt.value, 10);
          if (!Number.isNaN(asInt) && LABELS[asInt]) {
            opt.text = LABELS[asInt];
          } else {
            // If values are names (e.g., "superadmin"/"admin"), normalize them:
            const key = (opt.value || opt.text || '').toString().trim().toLowerCase().replace(/\s+/g,' ');
            if (key === 'superadmin' || key === 'super admin') opt.text = LABELS[1];
            else if (key === 'admin') opt.text = LABELS[2];
            else if (key === 'read only user' || key === 'read only' || key === 'readonly') opt.text = LABELS[3];
            else if (key === 'basic user' || key === 'basic' || key === 'user1') opt.text = LABELS[4];
          }
        });

        // Add tooltip so long selected names are fully visible on hover
        const setTitle = () => {
          const opt = sel.options[sel.selectedIndex];
          sel.title = opt ? opt.text : '';
        };
        sel.addEventListener('change', setTitle); setTitle();

        // Make sure the select stretches
        sel.classList.add('form-select'); sel.style.width = '100%';
      }

      // Hide any "is_super_admin" checkbox if present in the rendered form (front-end only)
      document.querySelectorAll('#editRoleBody input[type=checkbox][name$="is_super_admin"]').forEach(cb => {
        const row = cb.closest('p, .mb-3, div') || cb;
        row.style.display = 'none';
      });
    })();
  </script>
</div>
